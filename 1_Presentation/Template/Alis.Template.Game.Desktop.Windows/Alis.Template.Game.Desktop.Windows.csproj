<Project Sdk="Microsoft.NET.Sdk">

    <PropertyGroup Condition="$([MSBuild]::IsOSPlatform('windows'))">
        <OutputType>Exe</OutputType>
        <TargetFramework>net6.0</TargetFramework>
        <IsPackable>false</IsPackable>
        <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    </PropertyGroup>

    <ItemGroup Condition="$([MSBuild]::IsOSPlatform('windows'))">
        <ProjectReference Include="..\..\..\2_Application\Alis\src\Alis.csproj"/>
        <ProjectReference Include="..\Alis.Template.Game\Alis.Template.Game.csproj"/>
    </ItemGroup>

    <PropertyGroup Condition="$(NETCoreSdkRuntimeIdentifier.Contains('arm64')) AND $([MSBuild]::IsOSPlatform('windows'))">
        <RuntimeIdentifier>win-x64</RuntimeIdentifier>
        <PlatformTarget>x64</PlatformTarget>
    </PropertyGroup>

    <PropertyGroup Condition="$(NETCoreSdkRuntimeIdentifier.Contains('x64')) AND $([MSBuild]::IsOSPlatform('windows'))">
        <RuntimeIdentifier>win-x64</RuntimeIdentifier>
        <PlatformTarget>x64</PlatformTarget>
    </PropertyGroup>

    <PropertyGroup Condition="'$(Configuration)' == 'Debug'">
        <PublishTrimmed>false</PublishTrimmed>
    </PropertyGroup>

    <PropertyGroup Condition="'$(Configuration)' == 'Release'">
        <PublishTrimmed>true</PublishTrimmed>
    </PropertyGroup>

    <PropertyGroup Condition="$(NETCoreSdkRuntimeIdentifier.Contains('x86')) AND $([MSBuild]::IsOSPlatform('windows'))">
        <RuntimeIdentifier>win-x86</RuntimeIdentifier>
        <PlatformTarget>x86</PlatformTarget>
    </PropertyGroup>

    <PropertyGroup Condition="$([MSBuild]::IsOSPlatform('osx')) OR $([MSBuild]::IsOSPlatform('linux'))">
        <OutputType>Exe</OutputType>
        <TargetFrameworks>net6.0;</TargetFrameworks>
        <DefineConstants>$(DefineConstants);UNSUPPORTED;</DefineConstants>
    </PropertyGroup>

    <Target Name="RestrictOS" BeforeTargets="Compile">
        <PropertyGroup Condition="$([MSBuild]::IsOSPlatform('osx')) OR $([MSBuild]::IsOSPlatform('linux'))">
            <UnsupportedTarget>true</UnsupportedTarget>
        </PropertyGroup>
        <Warning Code="UNSUPPORTED" Text="Can't compile 'Windows apps' on MacOs or Linux OS." Condition=" '$(UnsupportedTarget)' == 'true' "/>
    </Target>
</Project>
