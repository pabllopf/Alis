<Project Sdk="Microsoft.NET.Sdk">
    <PropertyGroup>
        <TargetFramework>net10.0</TargetFramework>
        <LangVersion>13</LangVersion>
        <OutputType>Exe</OutputType>
        <RuntimeIdentifier>browser-wasm</RuntimeIdentifier>
        <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    </PropertyGroup>


    <ItemGroup>
        <ProjectReference Include="$(SolutionDir)2_Application/alis/src/alis.csproj"/>
    </ItemGroup>


    <ItemGroup>
        <ProjectReference Condition="$(ProjectDir.Contains('1_Presentation')) OR $(ProjectDir.Contains('2_Application'))"
                          Include="
          $(SolutionDir)4_Operation/**/**/generator/**/*Generator.csproj;
          $(SolutionDir)6_Ideation/**/**/generator/**/*Generator.csproj;"
                          OutputItemType="Analyzer"
                          PrivateAssets="all"
                          ReferenceOutputAssembly="false"/>
    </ItemGroup>

    <!-- ========== PROPIEDADES DE ASSETS ========== -->
    <PropertyGroup>
        <!-- Carpeta de recursos -->
        <AssetsDir>$(ProjectDir)Assets</AssetsDir>

        <!-- Archivos generados intermedios -->
        <AssetsZip>$(ProjectDir)obj/assets.zip</AssetsZip>
        <AssetsOutput>$(ProjectDir)obj/assets.pack</AssetsOutput>
    </PropertyGroup>


    <!-- ========== TARGET PARA GENERAR EL ZIP ========== -->
    <Target Name="ZipAssets" BeforeTargets="BeforeBuild;BeforePublish" Condition="Exists('$(ProjectDir)')">

        <Message Text="ZipAssets: AssetsDir='$(AssetsDir)'; AssetsZip='$(AssetsZip)'; AssetsOutput='$(AssetsOutput)'" Importance="High"/>

        <!-- Windows -->
        <Exec Condition="Exists('$(AssetsDir)') AND '$(OS)' == 'Windows_NT'"
              Command="powershell -NoLogo -Command &quot;Compress-Archive -Path '$(AssetsDir)\\*' -DestinationPath '$(AssetsZip)' -Force; [Convert]::ToBase64String([System.IO.File]::ReadAllBytes('$(AssetsZip)')) | Out-File -FilePath '$(AssetsOutput)' -Encoding ASCII&quot;"/>

        <!-- macOS/Linux -->
        <Exec Condition="Exists('$(AssetsDir)') AND '$(OS)' != 'Windows_NT'"
              Command="sh -c &quot;zip -r -9 '$(AssetsZip)' '$(AssetsDir)' &amp;&amp; base64 &lt; '$(AssetsZip)' &gt; '$(AssetsOutput)'&quot;"/>

        <!-- Si no hay AssetsDir -->
        <Message Condition="!Exists('$(AssetsDir)')" Text="No existe el directorio '$(AssetsDir)'. Se genera '$(AssetsOutput)' vacÃ­o." Importance="High"/>

        <Exec Condition="!Exists('$(AssetsDir)') AND '$(OS)' == 'Windows_NT'"
              Command="powershell -NoLogo -Command &quot;Set-Content -Path '$(AssetsOutput)' -Value '' -Encoding ASCII&quot;"/>

        <Exec Condition="!Exists('$(AssetsDir)') AND '$(OS)' != 'Windows_NT'"
              Command="sh -c &quot;mkdir -p '$(ProjectDir)obj' &amp;&amp; : &gt; '$(AssetsOutput)'&quot;"/>

    </Target>


    <!-- ========== REGISTRO DEL OUTPUT ========== -->
    <ItemGroup>
        <AdditionalFiles Include="$(AssetsOutput)"
                         CopyToOutputDirectory="Never"
                         CopyToPublishDirectory="Never"
                         Visible="false"/>
    </ItemGroup>
   


</Project>
