<Project>
    <Target Name="BuildGenerators" BeforeTargets="Build;Publish"
            Condition="
        $(AssemblyName.Contains('Generator')) == false AND
        $(AssemblyName.Contains('Test')) == false AND
        $(AssemblyName.Contains('Benchmark')) == false AND 
        $(AssemblyName.Contains('App')) == false AND
        $(AssemblyName.Contains('Template')) == false AND
        $(AssemblyName.Contains('Sample')) == false">

        <ItemGroup>
            <GeneratorProjects Include="
        $(SolutionDir)2_Application/**/generator/**/*Generator*.csproj;
        $(SolutionDir)3_Structuration/**/generator/**/*Generator*.csproj;
        $(SolutionDir)4_Operation/**/generator/**/*Generator*.csproj;
        $(SolutionDir)5_Declaration/**/generator/**/*Generator*.csproj;
        $(SolutionDir)6_Ideation/**/generator/**/*Generator*.csproj;" />
        </ItemGroup>

        <!-- Restaurar y compilar los generators -->
        <MSBuild Projects="@(GeneratorProjects)"
                 Targets="Restore;Build"
                 Properties="Configuration=$(Configuration);TargetFramework=netstandard2.0"
                 Condition="Exists('%(GeneratorProjects.Identity)')" />

        <!-- Definir las DLL generadas -->
        <ItemGroup>
            <GeneratorOutputs Include="@(GeneratorProjects->'%(RootDir)%(Directory)bin/$(Configuration)/netstandard2.0/%(Filename).dll')" />
        </ItemGroup>

        <!-- Copiar a la salida del proyecto actual -->
        <Copy SourceFiles="@(GeneratorOutputs)"
              DestinationFolder="bin/$(Configuration)/analyzers/dotnet/cs/"
              SkipUnchangedFiles="true"/>
    </Target>
</Project>
