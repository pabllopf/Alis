<Project>
    
    <Target Name="RestoreGenerators" BeforeTargets="Build;Publish"
            Condition="
      $(AssemblyName.Contains('Generator')) == false AND
      $(AssemblyName.Contains('Test')) == false AND
      $(AssemblyName.Contains('Benchmark')) == false AND 
      $(AssemblyName.Contains('Alis.App')) == false AND
      $(AssemblyName.Contains('Template')) == false AND
      $(AssemblyName.Contains('Sample')) == false">

        <ItemGroup>
            <GeneratorProjects Include="
        $(SolutionDir)2_Application/**/generator/**/*Generator*.csproj;
        $(SolutionDir)3_Structuration/**/generator/**/*Generator*.csproj;
        $(SolutionDir)4_Operation/**/generator/**/*Generator*.csproj;
        $(SolutionDir)5_Declaration/**/generator/**/*Generator*.csproj;
        $(SolutionDir)6_Ideation/**/generator/**/*Generator*.csproj;" />
        </ItemGroup>

        <!-- Restaurar los generators con dotnet restore -->
        <Exec Command='dotnet restore "%(GeneratorProjects.Identity)"'
              Condition="Exists('%(GeneratorProjects.Identity)')" />

        <!-- Compilar los generators con dotnet build -->
        <Exec Command='dotnet build "%(GeneratorProjects.Identity)" -c $(Configuration) -f netstandard2.0'
              Condition="Exists('%(GeneratorProjects.Identity)')" />
  
        <ItemGroup>
            <GeneratorOutputs Include="@(GeneratorProjects->'%(RootDir)%(Directory)bin/$(Configuration)/lib/netstandard2.0/%(Filename).dll')" />
        </ItemGroup>

        <ItemGroup>
          <FilesToCopy Include="@(GeneratorOutputs)"
                       Condition="!Exists('bin/$(Configuration)/analyzers/dotnet/cs/%(Filename)%(Extension)')" />
        </ItemGroup>
        <Copy SourceFiles="@(FilesToCopy)"
              DestinationFolder="bin/$(Configuration)/analyzers/dotnet/cs/"
              SkipUnchangedFiles="true"/>
    </Target>


</Project>
