<?xml version="1.0" encoding="utf-8"?>
<Project>
    <!-- Condición para habilitar cobertura y excluir ciertos proyectos -->
    <PropertyGroup Condition="$(AssemblyName.Contains('Sample')) == true OR $(AssemblyName.Contains('Test')) == true">
        <CollectCoverage>true</CollectCoverage>
        <ExcludeFromCodeCoverage>true</ExcludeFromCodeCoverage>
    </PropertyGroup>

    <!-- Añadir atributo ExcludeFromCodeCoverage para los proyectos Sample -->
    <ItemGroup Condition="$(AssemblyName.Contains('Sample')) == true">
        <AssemblyAttribute Include="System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverageAttribute"/>
    </ItemGroup>

    <!-- Excluir el archivo AutoGeneratedProgram.cs de la cobertura en proyectos Sample o Test -->
    <ItemGroup Condition="$(AssemblyName.Contains('Sample')) == true OR $(AssemblyName.Contains('Test')) == true">
        <ExcludeFromCodeCoverage Include="**/AutoGeneratedProgram.cs;**/*Test.cs" />
    </ItemGroup>


    <Target Condition="$(AssemblyName.Contains('Test')) == true" Name="UpdateAutoGeneratedProgramFiles" AfterTargets="Build">
        <ItemGroup>
            <AutoGeneratedProgramFiles Include="$(ProjectDir)obj/**/*.Program.cs" />
            <Line Include="line01"><Text>// This file has been auto generated.</Text></Line>
            <Line Include="line03"><Text>[System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverage]</Text></Line>
            <Line Include="line06"><Text>class AutoGeneratedProgram { static void Main(string[] args) {}}</Text></Line>
            <LineText Include="%(Line.Text)" />
        </ItemGroup>

        <Message Text="Updating @(AutoGeneratedProgramFiles)" Importance="high" />

        <WriteLinesToFile
            File="%(AutoGeneratedProgramFiles.FullPath)"
            Lines="@(LineText)"
            Overwrite="true"
        />
    </Target>

</Project>
